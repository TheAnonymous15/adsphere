{% extends "base.html" %}

{% block title %}Companies - AdSphere Admin{% endblock %}

{% block extra_styles %}
.company-card {
    transition: all 0.3s ease;
}
.company-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(99, 102, 241, 0.2);
}
{% endblock %}

{% block content %}
<div class="min-h-screen py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <div>
                <h1 class="text-3xl font-bold text-white">Companies</h1>
                <p class="text-gray-400 mt-1">Manage registered companies</p>
            </div>
            <button onclick="showAddCompanyModal()" class="bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 px-6 py-3 rounded-xl font-semibold flex items-center gap-2 transition">
                <i class="fas fa-plus"></i>
                Add Company
            </button>
        </div>

        <!-- Search & Filters -->
        <div class="glass-card rounded-2xl p-6 mb-8">
            <div class="flex flex-col md:flex-row gap-4">
                <div class="flex-1 relative">
                    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"></i>
                    <input type="text" id="searchCompanies" placeholder="Search companies..."
                           class="w-full bg-white/5 border border-white/10 rounded-xl pl-12 pr-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500">
                </div>
                <select class="bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-gray-300 focus:outline-none focus:border-indigo-500">
                    <option value="">All Status</option>
                    <option value="active">Active</option>
                    <option value="pending">Pending</option>
                    <option value="suspended">Suspended</option>
                </select>
                <select class="bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-gray-300 focus:outline-none focus:border-indigo-500">
                    <option value="">Sort By</option>
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="name">Name A-Z</option>
                </select>
            </div>
        </div>

        <!-- Companies Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="companiesGrid">
            {% if companies %}
                {% for company in companies %}
                <div class="company-card glass-card rounded-2xl p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                            <span class="text-white text-xl font-bold">{{ company.company_name[0]|upper if company.company_name else 'C' }}</span>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-medium
                            {% if company.status == 'active' %}bg-green-500/20 text-green-400
                            {% elif company.status == 'pending' %}bg-yellow-500/20 text-yellow-400
                            {% else %}bg-red-500/20 text-red-400{% endif %}">
                            {{ company.status|title if company.status else 'Active' }}
                        </span>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">{{ company.company_name }}</h3>
                    <p class="text-gray-400 text-sm mb-4">{{ company.company_email or 'No email' }}</p>

                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="bg-white/5 rounded-lg p-3 text-center">
                            <p class="text-2xl font-bold text-white">{{ company.ads_count if company.ads_count else 0 }}</p>
                            <p class="text-xs text-gray-500">Total Ads</p>
                        </div>
                        <div class="bg-white/5 rounded-lg p-3 text-center">
                            <p class="text-2xl font-bold text-white">{{ company.views_count if company.views_count else 0 }}</p>
                            <p class="text-xs text-gray-500">Views</p>
                        </div>
                    </div>

                    <div class="flex gap-2">
                        <button onclick="viewCompany('{{ company.company_slug }}')" class="flex-1 bg-white/5 hover:bg-white/10 py-2 rounded-lg text-sm transition">
                            <i class="fas fa-eye mr-1"></i> View
                        </button>
                        <button onclick="editCompany('{{ company.company_slug }}')" class="flex-1 bg-indigo-500/20 hover:bg-indigo-500/30 text-indigo-400 py-2 rounded-lg text-sm transition">
                            <i class="fas fa-edit mr-1"></i> Edit
                        </button>
                    </div>
                </div>
                {% endfor %}
            {% else %}
            <div class="col-span-full text-center py-12">
                <div class="w-20 h-20 bg-white/5 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-building text-3xl text-gray-600"></i>
                </div>
                <h3 class="text-xl font-medium text-gray-400 mb-2">No Companies Found</h3>
                <p class="text-gray-500 mb-4">Get started by adding your first company</p>
                <button onclick="showAddCompanyModal()" class="bg-indigo-500 hover:bg-indigo-600 px-6 py-2 rounded-lg transition">
                    <i class="fas fa-plus mr-2"></i>Add Company
                </button>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Add Company Modal -->
<div id="addCompanyModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="glass-card rounded-2xl p-8 w-full max-w-lg">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-white">Add New Company</h2>
            <button onclick="closeAddCompanyModal()" class="text-gray-400 hover:text-white">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <form id="addCompanyForm" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Company Name</label>
                <input type="text" name="company_name" required class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-indigo-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Email</label>
                <input type="email" name="company_email" required class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-indigo-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Password</label>
                <input type="password" name="password" required class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-indigo-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Phone</label>
                <input type="tel" name="phone" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-indigo-500">
            </div>
            <div class="flex gap-4 mt-6">
                <button type="button" onclick="closeAddCompanyModal()" class="flex-1 bg-white/5 hover:bg-white/10 py-3 rounded-xl transition">Cancel</button>
                <button type="submit" class="flex-1 bg-gradient-to-r from-indigo-500 to-purple-600 py-3 rounded-xl font-semibold">Create</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function showAddCompanyModal() {
        document.getElementById('addCompanyModal').classList.remove('hidden');
    }

    function closeAddCompanyModal() {
        document.getElementById('addCompanyModal').classList.add('hidden');
    }

    function viewCompany(slug) {
        window.location.href = `/companies/${slug}`;
    }

    function editCompany(slug) {
        window.location.href = `/companies/${slug}/edit`;
    }

    // Search functionality
    document.getElementById('searchCompanies').addEventListener('input', function(e) {
        const query = e.target.value.toLowerCase();
        document.querySelectorAll('.company-card').forEach(card => {
            const name = card.querySelector('h3').textContent.toLowerCase();
            card.style.display = name.includes(query) ? 'block' : 'none';
        });
    });

    // Form submission
    document.getElementById('addCompanyForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const formData = new FormData(this);

        try {
            const response = await fetch('/api/companies', {
                method: 'POST',
                body: formData
            });
            const data = await response.json();

            if (data.success) {
                window.location.reload();
            } else {
                alert(data.message || 'Error creating company');
            }
        } catch (error) {
            alert('Error creating company');
        }
    });
</script>
{% endblock %}

