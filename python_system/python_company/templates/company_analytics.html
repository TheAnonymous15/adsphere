<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Analytics - {{ company_name | default('Company') }} - AdSphere</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }
            50% { box-shadow: 0 0 35px rgba(99, 102, 241, 0.6); }
        }
        body {
            background: linear-gradient(135deg, #0f172a, #1e1b4b, #312e81);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .stat-card {
            animation: float 6s ease-in-out infinite;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 15px 30px rgba(99, 102, 241, 0.4);
        }
        .live-indicator {
            animation: pulse-glow 2s ease-in-out infinite;
        }
    </style>
</head>
<body class="text-white min-h-screen">

<!-- NAVBAR -->
<nav class="bg-slate-900/80 backdrop-blur-lg border-b border-white/10 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
            <div class="flex items-center gap-3">
                <a href="/dashboard" class="flex items-center gap-3 hover:opacity-80 transition">
                    <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-chart-line text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white">Analytics</h1>
                        <p class="text-xs text-gray-400">{{ company_name | default('Company') }}</p>
                    </div>
                </a>
            </div>
            <div class="flex items-center gap-4">
                <a href="/dashboard" class="text-gray-300 hover:text-white transition">
                    <i class="fas fa-arrow-left mr-2"></i>Dashboard
                </a>
                <a href="/my-ads" class="text-gray-300 hover:text-white transition">
                    <i class="fas fa-ad mr-2"></i>My Ads
                </a>
            </div>
        </div>
    </div>
</nav>

<!-- MAIN CONTENT -->
<div class="min-h-screen py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Header -->
        <div class="text-center mb-12">
            <div class="inline-flex items-center gap-2 bg-indigo-600/20 border border-indigo-600/50 rounded-full px-6 py-2 mb-4 live-indicator">
                <div class="w-3 h-3 bg-green-400 rounded-full animate-ping"></div>
                <span class="text-sm font-semibold ml-2">LIVE ANALYTICS</span>
            </div>
            <h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
                Performance Analytics
            </h1>
            <p class="text-gray-300">Real-time insights for your advertisements</p>
        </div>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
            <div class="glass-card rounded-2xl p-6 stat-card text-center">
                <i class="fas fa-ad text-4xl text-indigo-400 mb-4"></i>
                <div class="text-4xl font-bold mb-2" id="totalAds">0</div>
                <div class="text-sm text-gray-300">Active Ads</div>
            </div>
            <div class="glass-card rounded-2xl p-6 stat-card text-center" style="animation-delay: 0.2s;">
                <i class="fas fa-eye text-4xl text-purple-400 mb-4"></i>
                <div class="text-4xl font-bold mb-2" id="totalViews">0</div>
                <div class="text-sm text-gray-300">Total Views</div>
            </div>
            <div class="glass-card rounded-2xl p-6 stat-card text-center" style="animation-delay: 0.4s;">
                <i class="fas fa-heart text-4xl text-pink-400 mb-4"></i>
                <div class="text-4xl font-bold mb-2" id="totalFavorites">0</div>
                <div class="text-sm text-gray-300">Favorites</div>
            </div>
            <div class="glass-card rounded-2xl p-6 stat-card text-center" style="animation-delay: 0.6s;">
                <i class="fas fa-phone text-4xl text-green-400 mb-4"></i>
                <div class="text-4xl font-bold mb-2" id="totalContacts">0</div>
                <div class="text-sm text-gray-300">Contacts</div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-12">
            <!-- Views Chart -->
            <div class="glass-card rounded-2xl p-6">
                <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <i class="fas fa-chart-area text-blue-400"></i>
                    Views Over Time
                </h3>
                <div class="h-64">
                    <canvas id="viewsChart"></canvas>
                </div>
            </div>

            <!-- Contact Methods Chart -->
            <div class="glass-card rounded-2xl p-6">
                <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <i class="fas fa-chart-pie text-purple-400"></i>
                    Contact Methods
                </h3>
                <div class="h-64">
                    <canvas id="contactChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Top Performing Ads -->
        <div class="glass-card rounded-2xl p-6">
            <h3 class="text-xl font-bold mb-6 flex items-center gap-2">
                <i class="fas fa-trophy text-yellow-400"></i>
                Top Performing Ads
            </h3>
            <div id="topAdsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="animate-pulse bg-slate-700/50 rounded-xl h-32"></div>
                <div class="animate-pulse bg-slate-700/50 rounded-xl h-32"></div>
                <div class="animate-pulse bg-slate-700/50 rounded-xl h-32"></div>
            </div>
        </div>

    </div>
</div>

<script>
// Animated counter
function animateCounter(element, target, duration = 2000) {
    if (!element) return;
    let current = 0;
    const increment = target / (duration / 16);
    const timer = setInterval(() => {
        current += increment;
        if (current >= target) {
            element.textContent = Math.round(target).toLocaleString();
            clearInterval(timer);
        } else {
            element.textContent = Math.round(current).toLocaleString();
        }
    }, 16);
}

// Load analytics data
async function loadAnalytics() {
    try {
        const response = await fetch('/api/get_ads');
        const data = await response.json();

        if (data.success && data.ads) {
            const ads = data.ads;
            const totalAds = ads.length;
            const totalViews = ads.reduce((sum, ad) => sum + (ad.views || 0), 0);
            const totalFavorites = ads.reduce((sum, ad) => sum + (ad.favorites || 0), 0);
            const totalContacts = ads.reduce((sum, ad) => sum + (ad.contacts || 0), 0);

            animateCounter(document.getElementById('totalAds'), totalAds);
            animateCounter(document.getElementById('totalViews'), totalViews);
            animateCounter(document.getElementById('totalFavorites'), totalFavorites);
            animateCounter(document.getElementById('totalContacts'), totalContacts);

            // Views chart
            const viewsCtx = document.getElementById('viewsChart');
            if (viewsCtx) {
                new Chart(viewsCtx, {
                    type: 'line',
                    data: {
                        labels: ads.slice(0, 7).map(ad => (ad.title || 'Ad').substring(0, 15)),
                        datasets: [{
                            label: 'Views',
                            data: ads.slice(0, 7).map(ad => ad.views || 0),
                            borderColor: '#6366f1',
                            backgroundColor: 'rgba(99, 102, 241, 0.2)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#9ca3af' } },
                            x: { grid: { display: false }, ticks: { color: '#9ca3af' } }
                        }
                    }
                });
            }

            // Contact methods chart
            const contactCtx = document.getElementById('contactChart');
            if (contactCtx) {
                new Chart(contactCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Calls', 'WhatsApp', 'SMS', 'Email'],
                        datasets: [{
                            data: [35, 40, 15, 10],
                            backgroundColor: ['#6366f1', '#22c55e', '#eab308', '#ec4899']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'right', labels: { color: '#fff' } } }
                    }
                });
            }

            // Top ads
            const topAds = [...ads].sort((a, b) => (b.views || 0) - (a.views || 0)).slice(0, 3);
            document.getElementById('topAdsGrid').innerHTML = topAds.map((ad, i) => `
                <div class="bg-slate-900/50 rounded-xl p-4 border border-white/10">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-8 h-8 bg-${['yellow', 'gray', 'orange'][i]}-500/20 rounded-full flex items-center justify-center">
                            <span class="text-sm font-bold">#${i + 1}</span>
                        </div>
                        <h4 class="font-semibold truncate">${ad.title || 'Untitled'}</h4>
                    </div>
                    <div class="grid grid-cols-3 gap-2 text-center text-xs">
                        <div><p class="text-lg font-bold">${ad.views || 0}</p><p class="text-gray-400">Views</p></div>
                        <div><p class="text-lg font-bold">${ad.favorites || 0}</p><p class="text-gray-400">Favs</p></div>
                        <div><p class="text-lg font-bold">${ad.contacts || 0}</p><p class="text-gray-400">Contacts</p></div>
                    </div>
                </div>
            `).join('');
        }
    } catch (error) {
        console.error('Failed to load analytics:', error);
    }
}

document.addEventListener('DOMContentLoaded', loadAnalytics);
setInterval(loadAnalytics, 30000);
</script>
</body>
</html>

